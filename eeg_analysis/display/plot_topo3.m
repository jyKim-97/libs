function plot_topo3(facecolors, topo, varargin)
%{
function plot_topo3(facecolors, 'clim', 'badchannels')
(Need to run first calc_topo3.m)
### input
facecolors: num_of_ch X time points
clim: 1 X 2 ([cmin, cmax])
%}
% if ~isempty(varargin)
    % clim
    i = read_args(varargin, 'clim');
    if i, clim = varargin{i+1};
    else clim = [prctile(facecolors(:), 10), prctile(facecolors(:), 90)];
    end
    i = read_args(varargin, 'badchannels');
    if i, bad_ch = varargin{i+1}; else bad_ch = []; end
% end
fig = figure('Units', 'Normalized', 'pos', [0.3, 0.3, 0.3, 0.5]);
% init
patch('Faces',topo.g.faces,'Vertices',topo.g.vertices,'EdgeColor','none','FaceColor',[.5 .5 .5]); hold on;
p = patch('Faces',topo.g.faces(topo.ind_f,:),'Vertices',topo.g.vertices,'FaceVertexCData',[],...
    'facecolor','flat','edgecolor','none','facealpha', 1);
axis equal; axis tight; axis off; view(0,00); caxis(clim);
colormap jet
colorbar;
h=text(-.2,-4.5,0,'{\bfBP}', 'HorizontalAlign', 'center');
set(h,'FontSize',10,'FontWeight','Bold','Color','k');
h=text(-.2,-4.5,-4.2,'{\bfLP}', 'HorizontalAlign', 'center');
set(h,'FontSize',10,'FontWeight','Bold','Color','k');
[labels, elecpos] = get_vars();
for ch = 1:size(labels,1)
    if isempty(any(bad_ch == ch))
        plot3(elecpos(ch,1),elecpos(ch,3)-4.5,elecpos(ch,2),'o','markeredgecolor','none','markerfacecolor','k','markersize',2)
        % text(elecpos(ch,1)-0.11,elecpos(ch,2)-0.5,label{ch,1})
    else
        plot3(elecpos(ch,1),elecpos(ch,3)-4.5,elecpos(ch,2),'x','markeredgecolor','k','markerfacecolor','k','markersize',2)
    end
end
%% plot
for i = 1:size(facecolors, 2)
    p.FaceVertexCData = facecolors(:, i);
    drawnow;
    pause(0.5);
end
end

function [labels, elecpos] = get_vars()
labels = {'FP1';'FP2';'AF3';'AF4';'AF7';'AF8';...
    'F1';'F2';'F5';'F6';'FC1';'FC2';'FC5';'FC6';...
    'C1';'C2';'C3';'C4';'C5';'C6';'CP1';'CP2';'CP3';'CP4';'CP5';'CP6';...
    'P1';'P2';'P3';'P4';'P5';'P6';'PO3';'PO4';'PO7';'PO8';'O1';'O2';};

elecpos = [-1.461, 3.457, 0.437;...
    1.461, 3.457, 0.437;...
    -1.461, 2.396, 0.328;...
    1.461, 2.396, 0.328;...
    -2.147, 2.396, 0.483;...
    2.147, 2.396, 0.483;...
    -1.461, 1.131, 0.237;...
    1.461, 1.131, 0.237;...
    -2.396, 1.131, 0.501;...
    2.396, 1.131, 0.501;...
    -1.710, 0, 0.264;...
    1.710, 0, 0.264;...
    -3.243, 0, 0.738;...
    3.243, 0, 0.738;...
    -1.559, -0.989, 0.118;...
    1.559, -0.989, 0.118;...
    -2.512, -0.989, 0.292;...
    2.512, -0.989, 0.292;...
    -3.510, -0.989, 0.765;...
    3.510, -0.989, 0.765;...
    -1.666, -2.254, 0.0273;...
    1.666, -2.254, 0.0273;...
    -2.673, -2.254, 0.118;...
    2.673, -2.254, 0.118;...
    -3.670, -2.254, 0.610;...
    3.670, -2.254, 0.610;...
    -1.684, -3.332, 0.0182;...
    1.684, -3.332, 0.0182;...
    -2.949, -3.332, 0.346;...
    2.949, -3.332, 0.346;...
    -4.009, -3.332, 0.847;...
    4.009, -3.332, 0.847;...
    -1.675, -4.695, 0.292;...
    1.675, -4.695, 0.292;...
    -2.619, -4.695, 0.465;...
    2.619, -4.695, 0.465;...
    -1.764, -5.702, 0.474;...
    1.764, -5.702, 0.474];
end